<!DOCTYPE html>
<html>

<head>

    <title>Mobile tutorial - Leaflet</title>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <link rel="shortcut icon" type="image/x-icon" href="docs/images/favicon.ico" />

    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.6.0/dist/leaflet.css" integrity="sha512-xwE/Az9zrjBIphAcBb3F6JVqxf46+CDLwfLMHloNu6KEQCAWi6HcDUbeOfBIptF7tcCzusKFjFw2yuvEpDL9wQ==" crossorigin="" />
    <script src="https://unpkg.com/leaflet@1.6.0/dist/leaflet.js" integrity="sha512-gZwIG9x3wUXg2hdXF6+rVkLF/0Vi9U8D2Ntg4Ga5I5BZpVkVxlJWbSQtXPSiUTtC0TjtGOmxa1AJPuV0CPthew==" crossorigin=""></script>


    <style>
        html,
        body {
            height: 100%;
            margin: 0;
        }

        #map {
            width: 600px;
            height: 400px;
        }
    </style>

    <style>
        body {
            padding: 0;
            margin: 0;
        }

        #map {
            height: 100%;
            width: 100vw;
        }
    </style>
</head>

<body>

    <div id='map'></div>

    <script>
        navigator.geolocation.getCurrentPosition(success, error, options);
        var options = {
            enableHighAccuracy: true,
            timeout: 5000,
            maximumAge: 0
        };

        function log(data) {
            const tag = document.createElement('p');
            tag.textContent = data;
            document.body.appendChild(tag);
        }

        function success(pos) {
            var crd = pos.coords;
            run(crd);
            console.log('Successfully determined a user position:', crd);

            console.log('Your current position is:');
            console.log(`Latitude : ${crd.latitude}`);
            console.log(`Longitude: ${crd.longitude}`);
            console.log(`More or less ${crd.accuracy} meters.`);
        }

        function error(err) {
            console.warn(`ERROR(${err.code}): ${err.message}`);
        }


        function run(crd) {
            var map = L.map('map').setView([51.047513, 13.760959], 14);

            console.log(`${crd.latitude}`);
            console.log(`${crd.longitude}`);
            var latit = crd.latitude;
            var longit = crd.longitude;

            L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=pk.eyJ1IjoibWFwYm94IiwiYSI6ImNpejY4NXVycTA2emYycXBndHRqcmZ3N3gifQ.rJcFIG214AriISLbB6B5aw', {
                maxZoom: 18,
                attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/">OpenStreetMap</a> contributors, ' +
                    '<a href="https://creativecommons.org/licenses/by-sa/2.0/">CC-BY-SA</a>, ' +
                    'Imagery © <a href="https://www.mapbox.com/">Mapbox</a>',
                id: 'mapbox/streets-v11'
            }).addTo(map);


            var greenIcon = L.icon({
                iconUrl: 'my_location.png',
                //shadowUrl: 'leaf-shadow.png',

                iconSize: [30, 30], // size of the icon
                //shadowSize: [50, 64], // size of the shadow
                //iconAnchor: [22, 94], // point of the icon which will correspond to marker's location
                //shadowAnchor: [4, 62], // the same for the shadow
                //popupAnchor: [-3, -76] // point from which the popup should open relative to the iconAnchor
            });



            L.marker([51.052600, 13.746416]).addTo(map)
                .bindPopup('Sempersynagoge, Neue Synagoge', {
                    autoClose: false
                })
                .openPopup();

            L.marker([51.052094, 13.746435]).addTo(map)
                .bindPopup('Gemeindezentrum')
                .openPopup();

            L.marker([51.045176, 13.775006]).addTo(map)
                .bindPopup('Praxis von Dr. Katz', {
                    autoClose: false
                })
                .openPopup();

            L.marker([51.046397, 13.741316]).addTo(map)
                .bindPopup('Praxis Eugen Galewsky', {
                    autoClose: false
                })
                .openPopup();

            L.marker([51.051844, 13.737964]).addTo(map)
                .bindPopup('Triersches Haus<br>Tomche Nizrochim', {
                    autoClose: false
                })
                .openPopup();

            L.marker([51.046319, 13.737300]).addTo(map)
                .bindPopup('Bankhaus der Gebrüder Arnhold', {
                    autoClose: false
                })
                .openPopup();



            function onLocationFound(e) {
                var radius = e.accuracy / 2;


                console.log(e.latlng);
                latlngi = {
                    lat: latit,
                    lng: longit
                };
                console.log(latlngi);

                L.marker(latlngi, {
                        icon: greenIcon
                    }).addTo(map)
                    //.bindPopup("You are within " + radius + " meters from this point").openPopup();
                    .bindPopup("mein Standort").openPopup();

                //L.circle(latlngi, radius).addTo(map);
            }

            function onLocationError(e) {
                alert(e.message);
            }

            /*Update position */
            map.on('locationfound', onLocationFound);
            map.on('locationerror', onLocationError);
            map.on('locationfound', onLocationFound);

            function locate() {
                map.locate({
                    //setView: true
                    //maxZoom: 13
                });
            }

            // call locate every 5 seconds... forever
            setInterval(locate, 5000);
        }
    </script>



</body></html>
